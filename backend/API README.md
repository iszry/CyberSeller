# API

> 多数时候，前端开发人员**只需**阅览本API文档即可获取所有必要信息，无需查阅数据库README

## Django欢迎页

`http://43.143.179.158:8080/`

## 用户注册与登录

### signup用户注册

#### 发送

- 使用`POST`方法向服务器提供注册数据申请，数据格式为`raw`+`json`

- URL:`http://43.143.179.158:8080/signup`

- 具体属性如下：

| 属性     | 说明   | 类型                                              |
  | -------- | ------ | ------------------------------------------------- |
  | name     | 用户名 | 字符串，非空，长度小于`64`                        |
  | password | 密码   | 字符串，非空，长度小于`64`                        |
  | identity | 身份   | 字符串，非空，为`admin, customer, seller`三种之一 |

#### 接收

返回一个`HttpResponse`对象，属性列表如下：

| 属性    | 说明               | 类型                                                         |
| ------- | ------------------ | ------------------------------------------------------------ |
| succeed | 请求是否被成功执行 | 布尔值                                                       |
| code    | 处理结果代码       | 六位字符串，标识不同正确/错误情况，前两位固定为`01`表示是`signup`的code；中间两位错误时为`00`，正确时为`01`；最后两位表明是正确/错误情况中的具体情形，可以查阅下方的表 |
| message | 提示信息           | 提供更多关于本次请求处理结果的信息                           |
| id      | 注册得到的用户id   | 只有成功注册时返回一个正数，注册失败返回-1                   |

- 正确情况

| succeed | code     | message                         | id                   |
| ------- | -------- | ------------------------------- | -------------------- |
| `True`  | `010101` | `SUCCESS! Sign up successfully` | <数据库自动赋予的id> |

- 错误情况：

| succeed | code     | message                                                      | id   | 说明                                       | 处理方案                       |
| ------- | -------- | ------------------------------------------------------------ | ---- | ------------------------------------------ | ------------------------------ |
| `False` | `010000` | `ERROR! Empty name, password or identity, make sure they are legal` | `-1` | `name,password,identity`中有空值或空字符串 | 不执行请求，对数据库不产生影响 |
| `False` | `010001` | `ERROR! This URL accepts POST ONLY!`                         | `-1` | 使用非POST方法发送请求                     | 不执行请求，对数据库不产生影响 |
| `False` | `010002` | `ERROR! Too long name, make sure len <= 64`                  | `-1` | 用户名过长                                 | 不执行请求，对数据库不产生影响 |
| `False` | `010003` | `ERROR! Too long password, make sure len <= 64`              | `-1` | 密码过长                                   | 不执行请求，对数据库不产生影响 |
| `False` | `010004` | `ERROR! Illegal identity, make sure identity is admin, customer or seller` | `-1` | 非法身份                                   | 不执行请求，对数据库不产生影响 |
| `False` | `010005` | `ERROR! This name has been signed up, please choose another name` | `-1` | 重名用户名                                 | 不执行请求，对数据库不产生影响 |

### login用户登录

#### 发送

- 使用`POST`方法向服务器提供登录申请，数据格式为`raw`+`json`
- URL:`http://43.143.179.158:8080/login`
- 具体属性如下：

| 属性     | 说明   | 类型                       |
| -------- | ------ | -------------------------- |
| name     | 用户名 | 字符串，非空，长度小于`64` |
| password | 密码   | 字符串，非空，长度小于`64` |

#### 接收

返回一个`HttpResponse`对象，属性列表如下：

| 属性     | 说明             | 类型                                                         |
| -------- | ---------------- | ------------------------------------------------------------ |
| succeed  | 是否登陆成功     | 布尔值                                                       |
| code     | 处理结果代码     | 六位字符串，标识不同正确/错误情况，前两位固定为`02`表示是`login`的code；中间两位错误时为`00`，正确时为`01`；最后两位表明是正确/错误情况中的具体情形，可以查阅下方的表 |
| message  | 提示信息         | 提供更多关于本次请求处理结果的信息                           |
| id       | 登录得到的用户id | 返回数据库中该用户的唯一id，为`int`                          |
| balance  | 该用户账户余额   | 返回余额                                                     |
| identity | 用户身份         | 字符串                                                       |

- 正确情况

| succeed | code     | message                        | id                   | balance          | identity     |
| ------- | -------- | ------------------------------ | -------------------- | ---------------- | ------------ |
| `True`  | `020101` | `SUCCESS! Log in successfully` | <数据库自动赋予的id> | <该用户账户余额> | <该用户身份> |

- 错误情况

| succeed | code     | message                                                    | id                   | balance | identity     | 说明                              |
| ------- | -------- | ---------------------------------------------------------- | -------------------- | ------- | ------------ | --------------------------------- |
| `False` | `020000` | `ERROR! This URL accepts POST ONLY! `                      | -1                   | -1      | `FAIL`       | 使用非POST方法发送请求            |
| `False` | `020001` | `ERROR! Empty name or password, make sure they are legal`  | -1                   | -1      | `FAIL`       | `name,password`中有空值或空字符串 |
| `False` | `020002` | `ERROR! Non-exist name, make sure the name is correct`     | -1                   | -1      | `FAIL`       | 用户名错误                        |
| `False` | `020003` | `ERROR! Wrong password, make sure the password is correct` | <数据库自动赋予的id> | -1      | <该用户身份> | 密码错误                          |

### addGoods添加售卖商品

#### 发送

- 使用`POST`方法向服务器提供登录申请，数据格式`form-data`

- URL:`http://43.143.179.158:8080/addGoods`

- 具体属性如下：

| 属性        | 说明     | 类型                                                 |
| ----------- | -------- | ---------------------------------------------------- |
| name        | 商品名   | 字符串，**非空**，长度小于`64`                       |
| price       | 价格     | 精确小数（小数点后2位），**非空**，长度小于`20`      |
| seller_id   | 卖家ID   | 整数，**非空**，对应Account表中的ID                  |
| maker       | 制造商   | 字符串，可空，长度小于64                             |
| picture     | 图片     | 文件，**非空**，只能发送一张图片                     |
| description | 描述     | 字符串，可空，长度小于512                            |
| date        | 生产日期 | 字符串，可空，须形如yyyy-mm-dd，如`2021-01-10`       |
| shelf_life  | 保质期   | 字符串，可空，须形如yyyy-mm-dd-hh，如`0001-10-23-03` |

#### 接收

返回一个`JsonResponse`对象，属性列表如下：

| 属性    | 说明             | 类型                                                         |
| ------- | ---------------- | ------------------------------------------------------------ |
| succeed | 是否成功添加商品 | 布尔值                                                       |
| code    | 处理结果代码     | 六位字符串，标识不同正确/错误情况，前两位固定为`03`表示是`addGoods`的code；中间两位错误时为`00`，正确时为`01`；最后两位表明是正确/错误情况中的具体情形，可以查阅下方的表 |
| message | 提示信息         | 提供更多关于本次请求处理结果的信息                           |

- 正确情况

| succeed | code     | message                             |
| ------- | -------- | ----------------------------------- |
| `True`  | `030101` | `SUCCESS! Add a good successfully!` |

- 错误情况

| succeed | code     | message                             |
| ------- | -------- | ----------------------------------- |
| `False` | `030000` | `ERROR! Need available good name! ` |
| `False` | `030001` | `ERROR! Need available good price!` |
| `False` | `030002` | `ERROR! Need available seller id`   |
| `False` | `030003` | `ERROR! Need available pic file`    |

### addShopCart添加商品到购物车

#### 发送

- 使用`POST`方法向服务器提供登录申请，数据格式`form-data`

- URL:`http://43.143.179.158:8080/addShopCart`

- 具体属性如下：

| 属性      | 说明   | 类型                                          |
| --------- | ------ | --------------------------------------------- |
| user_id   | 用户id | 整数，**非空**，和Account对应                 |
| good_id   | 商品id | 精确小数（小数点后2位），**非空**，和Good对应 |
| seller_id | 卖家ID | 整数，**非空**，对应Account表中的ID           |

/* TODO */

#### 接收

/* TODO */



### mainRecommendGoods为用户推荐商品

#### 发送

- 使用`POST`方法向服务器提供登录申请，数据格式`form-data`

- URL:`http://43.143.179.158:8080/mainRecommentGoods`

- 具体属性如下：

| 属性    | 说明   | 类型                          |
| ------- | ------ | ----------------------------- |
| user_id | 用户id | 整数，**非空**，和Account对应 |

#### 接收

| 属性    | 说明           | 类型                                                         |
| ------- | -------------- | ------------------------------------------------------------ |
| succeed | 是否查询成功   | 布尔值                                                       |
| code    | 处理结果代码   | 六位字符串，标识不同正确/错误情况，前两位固定为`05`表示是`mainRecommendGoods`的code；中间两位错误时为`00`，正确时为`01`；最后两位表明是正确/错误情况中的具体情形，可以查阅下方的表 |
| message | 提示信息       | 字符串，提供更多关于本次请求处理结果的信息                   |
| n       | 返回的商品数量 | 整数，当执行错误时，该值为`-1`，执行正确时，该值为商品数量   |
| goods   | 商品列表       | 包含有`n`个元素，每个元素是一个商品`json`，每个商品`json`结构见下表。 |

**商品`json`**

| 属性        | 说明      | 类型                             |
| ----------- | --------- | -------------------------------- |
| id          | 商品`id`  | 互不相同的整数，是标识商品的主码 |
| name        | 商品名    | 字符串，商品名                   |
| price       | 价格      | 字符串，精确到小数点后两位       |
| seller_id   | 卖家`id`  | 互不相同的整数，是标识用户的主码 |
| maker       | 制造商名  | 字符串，制造商名                 |
| picture     | 图片`url` | 字符串，商品图片`url`            |
| description | 商品描述  | 字符串，商品详细描述             |
| date        | 生产日期  | 字符串，形如yyyy-mm-dd           |
| shelf_life  | 保质期    | 字符串，形如yyyy-mm-dd-hh        |

- 正确情况

| succeed | code     | message                                        |
| ------- | -------- | ---------------------------------------------- |
| `True`  | `050101` | `SUCCESS! Get goods recommended successfully!` |

- 错误情况

| succeed | code     | message                         |
| ------- | -------- | ------------------------------- |
| `False` | `050000` | `ERROR! Need non-null userid! ` |
| `False` | `050001` | `ERROR! Need available userid!` |
