# 数据库答辩手稿

## P1

各位老师、助教好，我们小组要答辩的项目是CyberSeller，一个线上交易平台，下面开始答辩。

## P2

我们将从项目简介、系统展示和数据库设计三个方面来进行讲解。

## P3

首先是第一部分，项目简介。

## P4

为什么我们要开发这样一个线上交易平台呢？这是因为疫情让我们发现了社会中存在的一种小范围社交群体，他们可能是同住在一个小区的邻居，可能是生活在同一个学校的同学，也可能是某种独特爱好的发烧友，他们彼此间经常有一些商品交易往来，但却少有专门的平台供他们使用。如传统的二手交易群容易错过消息，咸鱼等传统电商平台界面繁琐且存在一定的使用门槛。对此，我们设计了CyberSeller这样一个纯粹的线上交易平台，任何用户在这里都既是买家，也是卖家。

## P5

这张图向我们展示了交易平台的基本功能，它集成了商品预览、商品出售、支付系统、数据分析等基础模块，在满足用户对买卖商品的需求的基础之上，我们还为用户提供了一定程度的个性化推荐及数据分析功能。

## P6

下一个部分，我们将展示我们的系统。

## P7

首先，在打开我们的网址后，便会以游客模式访问系统的主页。在主页的上方，我们使用一定的算法为用户个性化推送了六张滚动播放的商品图片。主页中央是搜索框，用户可以对所有商品的商品信息进行检索筛选。主页的下方陈列了平台内的所有商品，在页面底部也为用户提供了翻页及页面跳转功能。

## P8

如图所示，当我们在搜索“狐”时，系统会进行全局检索，将包含“狐”的商品都作为结果展示，这里的每个商品也都可以点击进入

## P9

当我们选中某一个商品后，便可以进入其商品详情页查看更多详细信息，我们可以选定不超过库存数量的商品将其加入购物车，或者将该商品加入收藏夹留待以后查看。在商品详情页的下方，我们同样使用一定的算法为用户进行相似商品推荐，用户可以在此处直接访问其他商品链接。

## P10

对于卖家来说，可以通过提供一定的商品信息来在页面左侧发布新的商品，其必须给出的参数为商品名、商品价格和商品图片，其他参数为可选参数。此外，卖家也可以通过`其他`选项卡上传Excel文件让后端对其解析并展示。在右侧的列表中，卖家可以查看并编辑自己已经发布的所有商品，可以选择修改其库存或直接将商品下架。

## P11

买家可以在自己的购物车中选择部分或全部仍未售罄的商品进行结算，随后进入到结算界面，买家选择地址后即可进行结算，生成最终的订单。

## P12

在数据分析页面中共有四个图表，左上角的柱状图会动态对用户的历史消费记录进行动态排序，以日为单位对历史总消费额进行统计；右上角的饼状图会对用户购物车中的商品来源进行统计；左下角的饼状图会对用户的历史支付中的资金流向进行统计；右下角的饼状图会对用户的历史订单按成交次数分布进行统计。由于以上图表均为动态显示模式，所以用户可以根据需求对图表显示数据进行进一步筛选查看。

## P13 

最后一个部分是数据库与服务端设计

## P14

首先是数据库设计的实体部分。我们设计了账户、商品、购物车、收藏、库存等实体，其中下划线是主码。

## P15

这一页展示了地址、订单、订单商品、商品详情等实体。

## P16

通过关系的规范化，我们的数据库达到了3范式并同时保持无损连接和函数依赖。举例而言，订单包含卖家、商品等大量信息，我们选择将其分解为如下四个关系，分别是用户、商品、订单和订单商品，实现了解耦，保证了无损连接与函数依赖，达到了3范式。

## P17

在之前介绍的概念模型的基础上，我们实现了数据表，这里以商品表为例，其包括编号作为主码，商品名、价格、卖家编号、制造商、图片地址、详细描述、生产日期和保质期等属性。右上图是这些属性的定义，下方是数据库中部分数据的展示

## P18

接着是数据库设计中的触发器。触发器对于保证数据一致性有很大帮助，有时将数据更新在数据库层面完成可以简化高级语言的处理逻辑。但是触发器的性能并不优秀，而且可能出现循环触发等问题，因此我们这里展示的示例是保证库存大于等于0，耦合度较小。当后端接收到更新库存请求时，会检查新库存值是否小于0，若小于0则拒绝该请求并报错，右上图是该触发器代码，下图是对于错误请求的相应情况。

## P19

然后是数据库设计中的存储过程。对于项目中较为复杂的操作，我们在SQL层面封装为过。由于SQL中的函数于过程是预先编译并存入DBMS中的，调用的时候内部不需要解释执行，这提高了SQL的执行效率，也简化了高级语言的处理逻辑。这里展示的示例是检索特定后缀的商品，该存储过程会根据用户输入的关键词检索拥有该后缀的商品，上方时存储过程代码，下方是调用结果。

## P20

接着是数据库设计中的函数。在这个示例中，用户对商品的价格区间的敏感度大于对用户对具体价格的敏感度，因此设计了函数来获取用户对商品价格的评价。左边是函数代码，右边是查询结果。

## P21

这一部分是数据流图，完整展示了本系统的数据流。首先用户在注册账户，相关信息被储存到用户信息表中，然后用户登录，通过比对登录信息来判定是否登陆成功，对于未注册用户也可以浏览商品信息。登录后对用户进行类别鉴别，对于管理员用户，可以浏览管理所有用户订单并管理商品信息，对于普通用户，可以修改自己的收货地址，发布自己的商品并加入到商品列表中，可以浏览订单信息和商品信息。对于商品，可以将其添加到收藏表中，也可以添加到购物车中，对于购物车中商品，可以选中并生成订单最后支付。

## P22（本页可多停留一会）

这是数据库设计的ER图，完整展示了全局概念模式，由实体、联系和属性具体组成。

## P23

然后是索引优化，对于查询常用属性添加索引可以答复提高查询效率，由于码的查询频次高，外键多用于关系的连接操作，因此我们将关系的索引设置在主码和外键上，如购物车表中的码是编号，外键是用户编号和商品编号。

## P24

接着是服务端设计的前后端分离。后端我们采用了Django框架和MySQL数据库相结合并上线架设在腾讯云服务器，前端以路由-控制器-渲染的模式进行沟通连接。

## P25

这里是URL服务响应示例，该API的作用是获取销售商品。通过POST方法向URL发送合适的数据可以得到正确的返回。如下图所示是利用POSTMAN进行模拟POST请求发送的结果。

## P26

接着是服务端设计的MVC模式。MVC模式是软件工程的一种软件架构模式，将软件分为三个部分，模型model，视图view和控制器controller。本系统也采用了该模式来更高效地合作。

## P27

然后是安全设计中的防范非法POST请求。在该示例中，我们防范使用非法手段直接向后端发送addGood（添加商品）请求，该非法请求会由于表单中没有指定seller_id而被拒绝。

## P28

我们的答辩到此结束，谢谢大家。